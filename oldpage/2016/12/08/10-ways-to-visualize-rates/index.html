<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>10 ways to visualize mortgage rates </title>
    
    <meta name="author" content="Len Kiefer">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link href="/assets/themes/lentheme/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    
    <link href="/assets/themes/lentheme/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    
    <link href="/assets/themes/lentheme/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    
    <link href="/assets/themes/lentheme/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    
    
    

    
    

    
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><span class="icon-home3" style="font-size:24px"> Len Kiefer</a></span>
        </div>

        
        <div class="collapse navbar-collapse" id="jb-navbar-collapse" style="font-size:24px">
          <ul class="nav navbar-nav" >
        <li><a href="/archive.html"><span class="icon-newspaper"> Posts</a></span></li>
            
         <li><a href="/resume.html"><span class="icon-profile"> Resume</span></a></li>
        <li><a href="/about.html"><span class="icon-user-tie"> About</span></a></li>
          </ul>
        </div>
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>10 ways to visualize mortgage rates  </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>08 December 2016</span>
    </div>
    <div class="content">
      <h1 id="introduction">Introduction</h1>

<p>IN ORDER TO HELP PEOPLE UNDERSTAND WHAT’S GOING ON with the economy, housing and mortgage markets I spend a great deal of time thinking about interest rates.  Interest rates, specifically mortgage rates are very important to housing and mortgage markets.  In my <a href="https://www.linkedin.com/in/leonard-kiefer-51175331">professional life</a> I work on tracking trends in housing and mortgage markets, and that includes mortgage rates.  I create a lot of visualizations of mortgage rates.</p>

<p>In this post I’m going to share with you 10 of my favorate ways to visualize mortgage rates and give you <a href="https://www.r-project.org/">R</a> code to do it.</p>

<h2 id="the-data">The data</h2>

<p>The data I’m going to use are estimates of weekly U.S. average 30-year fixed mortgage rates from the <a href="http://www.freddiemac.com/pmms/index.html">Primary Mortgage Market Survey</a> from Freddie Mac. These data can be easily downloaded from the St. Louis Fred database <a href="http://bit.ly/2hli7Sh">here</a>.</p>

<p>I have the data saved in a simple text file with a column for data, the mortgage rate, and helper columns week, month, and year, where week is the week number starting with the first week of the year.</p>

<p>Let’s load the data and take a peek.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#load libraries
</span><span class="n">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">zoo</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">zoo</span><span class="p">,</span><span class="n">warn.conflicts</span><span class="o">=</span><span class="n">F</span><span class="p">,</span><span class="n">quietly</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">,</span><span class="n">warn.conflicts</span><span class="o">=</span><span class="n">F</span><span class="p">,</span><span class="n">quietly</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">xts</span><span class="p">,</span><span class="n">warn.conflicts</span><span class="o">=</span><span class="n">F</span><span class="p">,</span><span class="n">quietly</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">,</span><span class="n">warn.conflicts</span><span class="o">=</span><span class="n">F</span><span class="p">,</span><span class="n">quietly</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">viridis</span><span class="p">,</span><span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">F</span><span class="p">,</span><span class="n">quietly</span> <span class="o">=</span> <span class="n">F</span><span class="p">)</span> <span class="c1">#for the colorz
</span><span class="n">library</span><span class="p">(</span><span class="s2">"htmlTable"</span><span class="p">)</span>
<span class="c1">#load data from text file
</span><span class="n">pmms30yr</span> <span class="o">&lt;-</span> <span class="n">fread</span><span class="p">(</span><span class="s2">"data/pmms30yr.txt"</span><span class="p">)</span>
<span class="c1">#set up date variable
</span><span class="n">pmms30yr</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">pmms30yr</span><span class="o">$</span><span class="n">date</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/%d/%Y"</span><span class="p">)</span>

<span class="c1"># make tables for viewing formatting dates with purr %&gt;% operations
</span><span class="n">htmlTable</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">pmms30yr</span> <span class="o">%&gt;%</span> <span class="n">map_if</span><span class="p">(</span><span class="n">is.Date</span><span class="p">,</span> <span class="n">as.character</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%b %d,%Y"</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">map_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">,</span> <span class="n">round</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="o">%&gt;%</span><span class="n">as.data.frame</span><span class="p">()</span> <span class="p">,</span><span class="m">10</span><span class="p">),</span> <span class="n">col.rgroup</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"none"</span><span class="p">,</span> <span class="s2">"#F7F7F7"</span><span class="p">),</span><span class="n">caption</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate (%)"</span><span class="p">,</span>
          <span class="n">tfoot</span><span class="o">=</span><span class="s2">"Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span></code></pre></figure>

<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr><td colspan="6" style="text-align: left;">
30-year Fixed Mortgage Rate (%)</td></tr>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey;"> </th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">date</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">rate</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">year</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">month</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">week</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: center;">Apr 02,1971</td>
<td style="text-align: center;">7.33</td>
<td style="text-align: center;">1971</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">14</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="background-color: #f7f7f7; text-align: left;">2</td>
<td style="background-color: #f7f7f7; text-align: center;">Apr 09,1971</td>
<td style="background-color: #f7f7f7; text-align: center;">7.31</td>
<td style="background-color: #f7f7f7; text-align: center;">1971</td>
<td style="background-color: #f7f7f7; text-align: center;">4</td>
<td style="background-color: #f7f7f7; text-align: center;">15</td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: center;">Apr 16,1971</td>
<td style="text-align: center;">7.31</td>
<td style="text-align: center;">1971</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">16</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="background-color: #f7f7f7; text-align: left;">4</td>
<td style="background-color: #f7f7f7; text-align: center;">Apr 23,1971</td>
<td style="background-color: #f7f7f7; text-align: center;">7.31</td>
<td style="background-color: #f7f7f7; text-align: center;">1971</td>
<td style="background-color: #f7f7f7; text-align: center;">4</td>
<td style="background-color: #f7f7f7; text-align: center;">17</td>
</tr>
<tr>
<td style="text-align: left;">5</td>
<td style="text-align: center;">Apr 30,1971</td>
<td style="text-align: center;">7.29</td>
<td style="text-align: center;">1971</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">18</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="background-color: #f7f7f7; text-align: left;">6</td>
<td style="background-color: #f7f7f7; text-align: center;">May 07,1971</td>
<td style="background-color: #f7f7f7; text-align: center;">7.38</td>
<td style="background-color: #f7f7f7; text-align: center;">1971</td>
<td style="background-color: #f7f7f7; text-align: center;">5</td>
<td style="background-color: #f7f7f7; text-align: center;">19</td>
</tr>
<tr>
<td style="text-align: left;">7</td>
<td style="text-align: center;">May 14,1971</td>
<td style="text-align: center;">7.42</td>
<td style="text-align: center;">1971</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">20</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="background-color: #f7f7f7; text-align: left;">8</td>
<td style="background-color: #f7f7f7; text-align: center;">May 21,1971</td>
<td style="background-color: #f7f7f7; text-align: center;">7.44</td>
<td style="background-color: #f7f7f7; text-align: center;">1971</td>
<td style="background-color: #f7f7f7; text-align: center;">5</td>
<td style="background-color: #f7f7f7; text-align: center;">21</td>
</tr>
<tr>
<td style="text-align: left;">9</td>
<td style="text-align: center;">May 28,1971</td>
<td style="text-align: center;">7.46</td>
<td style="text-align: center;">1971</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">22</td>
</tr>
<tr style="background-color: #f7f7f7;">
<td style="background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: left;">10</td>
<td style="background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: center;">Jun 04,1971</td>
<td style="background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: center;">7.52</td>
<td style="background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: center;">1971</td>
<td style="background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: center;">6</td>
<td style="background-color: #f7f7f7; border-bottom: 2px solid grey; text-align: center;">23</td>
</tr>
</tbody>
<tfoot><tr><td colspan="6">
Source: Freddie Mac Primary Mortgage Market Survey</td></tr></tfoot>
</table>

<p>The data are weekly observations on mortgage rates running from April 2, 1971 through December 8, 2016.  Now let’s take these series and make 10 different visualizations. We’ll start simple, and build up to more complex visualizations.</p>

<h3 id="a-note-on-data-manipulations">A note on data manipulations</h3>

<p>I’m going to be using the <a href="https://cran.r-project.org/web/packages/data.table/index.html">data.table()</a> package from R.  I’ve found this package very helpful for doing the types of data manipulations I most frequently need.  Check the comments in the code below for specific callouts.</p>

<h1 id="a-simple-line-chart">1: A simple line chart</h1>

<p>Let’s start simple with a line chart.  We’ll also add some styling including a reference line at the last monthly observation and a dot at the last point.  We’ll start the data in 2001.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">g1</span><span class="o">&lt;-</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;</span><span class="s1">'2000-12-31'</span><span class="p">],</span>  
       <span class="c1">#We're going to subset the data to be after Dec 31, 2000.  
</span>       <span class="c1">#We could use filter function, but instead I'm using the data.table() shorthand
</span>        <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">rate</span><span class="p">))</span><span class="o">+</span><span class="n">geom_line</span><span class="p">()</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="c1">#set date breaks at 1 year, format as 2000 ("%Y"), 00 would be "%y"
</span>    <span class="n">scale_x_date</span><span class="p">(</span><span class="n">date_breaks</span><span class="o">=</span><span class="s2">"1 year"</span><span class="p">,</span> <span class="n">date_labels</span><span class="o">=</span><span class="s2">"%Y"</span><span class="p">)</span><span class="o">+</span>  
  <span class="c1">#add text, marker and reference line for last observation
</span>  <span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tail</span><span class="p">(</span><span class="n">pmms30yr</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">nudge_y</span><span class="o">=</span><span class="m">.25</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">+</span>
  <span class="c1">#use nudge_y to lift label above point
</span>  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tail</span><span class="p">(</span><span class="n">pmms30yr</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>
  <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="n">tail</span><span class="p">(</span><span class="n">pmms30yr</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="o">$</span><span class="n">rate</span><span class="p">,</span><span class="n">linetype</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.82</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate (%)"</span><span class="p">,</span>
       <span class="n">subtitle</span><span class="o">=</span><span class="s2">"weekly rates since 2001"</span><span class="p">,</span>
       <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="n">g1</span></code></pre></figure>

<p><img src="/img/Rfig/rate-viz1-dec-08-2016,-1.svg" alt="plot of chunk rate-viz1-dec-08-2016," /></p>

<h1 id="line-chart-comparing-weeks-by-year">2: Line chart comparing weeks by year</h1>

<p>This next chart is a variation on the line chart.  Instead of using date for the <em>x</em> axis, we use the week of the year and plot a separate line for recent years (2013, 2014, 2015 and 2016). By comparing the lines at any point on the <em>x</em> axis, we can see where rates were one or more years ago on this week.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">i</span><span class="o">&lt;-</span><span class="n">max</span><span class="p">(</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">==</span><span class="m">2016</span><span class="p">]</span><span class="o">$</span><span class="n">week</span><span class="p">)</span>  <span class="c1">#figure out the maximum week number in 2016
</span>
<span class="n">g2</span><span class="o">&lt;-</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2012</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">],</span> 
           <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">week</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="s2">"   "</span><span class="p">,</span><span class="n">year</span><span class="p">),</span>
               <span class="n">linetype</span><span class="o">=</span><span class="n">as.factor</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
               <span class="n">color</span><span class="o">=</span><span class="n">as.factor</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1.05</span><span class="p">)</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">54</span><span class="p">),</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">55</span><span class="p">,</span><span class="m">5</span><span class="p">))</span><span class="o">+</span>
    <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">3.25</span><span class="p">,</span><span class="m">4.75</span><span class="p">),</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">3.25</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">0.25</span><span class="p">))</span><span class="o">+</span>
    <span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2012</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">==</span><span class="n">i</span><span class="p">],</span><span class="n">nudge_x</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2012</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">==</span><span class="n">i</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">3.5</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Week Number"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Mortgage Rate (%)"</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate by Week of Year"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"comparing 2013, 2014, 2015 and 2016"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="n">g2</span></code></pre></figure>

<p><img src="/img/Rfig/rate-viz2-dec-08-2016,-1.svg" alt="plot of chunk rate-viz2-dec-08-2016," /></p>

<h1 id="area-chart-showing-year-over-year-changes">3: Area chart showing year-over-year changes</h1>

<p>In this next chart we’re going to compute a rolling 52-week difference. We also want to shade in the area between the line difference colors based on whether or not rates are up or down.  Shading between two lines in ggplot is tricky, so I’m going to actually create two series, one for positive 52-week changes and another for negative 52-week changes.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">pmms30yr</span><span class="p">[,</span><span class="n">d52</span><span class="o">:=</span><span class="n">rate</span><span class="o">-</span><span class="n">shift</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span><span class="m">52</span><span class="p">)]</span>
<span class="n">pmms30yr</span><span class="p">[,</span><span class="n">d52.up</span><span class="o">:=</span><span class="n">ifelse</span><span class="p">(</span><span class="n">d52</span><span class="o">&gt;</span><span class="m">0</span><span class="p">,</span><span class="n">d52</span><span class="p">,</span><span class="m">0</span><span class="p">)]</span>      <span class="c1">#if diff &gt;0, diff in rates, else 0
</span><span class="n">pmms30yr</span><span class="p">[,</span><span class="n">d52.down</span><span class="o">:=</span><span class="n">ifelse</span><span class="p">(</span><span class="n">d52</span><span class="o">&lt;</span><span class="m">0</span><span class="p">,</span><span class="n">d52</span><span class="p">,</span><span class="m">0</span><span class="p">)]</span>    <span class="c1">#if diff &lt;0, diff in rates, else 0
</span>
<span class="n">g3</span><span class="o">&lt;-</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;</span><span class="s1">'1979-12-31'</span><span class="p">],</span>  
       <span class="c1">#We're going to subset the data to be after Dec 31, 2000.  
</span>       <span class="c1">#We could use filter function, but instead I'm using the data.table() shorthand
</span>        <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">d52</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">rate</span><span class="p">))</span><span class="o">+</span><span class="n">geom_line</span><span class="p">()</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="c1">#set date breaks at 1 year, format as 2000 ("%Y"), 00 would be "%y"
</span>    <span class="n">scale_x_date</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"1980-01-01"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2020-01-01"</span><span class="p">),</span><span class="s2">"5 years"</span><span class="p">),</span> <span class="n">date_labels</span><span class="o">=</span><span class="s2">"%Y"</span><span class="p">)</span><span class="o">+</span>  
  <span class="c1">#add text, marker and reference line for last observation
</span>  <span class="n">geom_area</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">d52.down</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">viridis</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">4</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="o">+</span>  <span class="c1">#shade green if down
</span>  <span class="n">geom_area</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">d52.up</span><span class="p">),</span><span class="n">fill</span><span class="o">=</span><span class="n">viridis</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="o">+</span>    <span class="c1"># shade blue if up
</span>  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate"</span><span class="p">,</span>
       <span class="n">subtitle</span><span class="o">=</span><span class="s2">"52-week change in percentage points"</span><span class="p">,</span>
       <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="n">g3</span></code></pre></figure>

<p><img src="/img/Rfig/rate-viz3-dec-08-2016,-1.svg" alt="plot of chunk rate-viz3-dec-08-2016," /></p>

<h1 id="combo-line-with-rugplot">4: Combo line with rugplot</h1>

<p>We can enhance this plot by adding a <a href="http://docs.ggplot2.org/0.9.2.1/geom_rug.html">marginal rug plot</a> to the bottom of the chart indicating whether or not rates are up or down for that week.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">g4</span><span class="o">&lt;-</span><span class="n">g3</span><span class="o">+</span>
  <span class="n">geom_rug</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">&gt;</span><span class="m">1979</span> <span class="o">&amp;</span> <span class="n">d52</span><span class="o">&lt;</span><span class="m">0</span><span class="p">,],</span>
           <span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">d52.down</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">viridis</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">4</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="n">sides</span><span class="o">=</span><span class="s2">"b"</span><span class="p">)</span><span class="o">+</span>  <span class="c1"># Only put rug at bottom
</span>  <span class="n">geom_rug</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">&gt;</span><span class="m">1979</span> <span class="o">&amp;</span> <span class="n">d52</span><span class="o">&gt;</span><span class="m">0</span><span class="p">,],</span>
           <span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">d52.up</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">viridis</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="n">sides</span><span class="o">=</span><span class="s2">"b"</span><span class="p">)</span>     <span class="c1"># Only put rug at bottom
</span><span class="n">g4</span></code></pre></figure>

<p><img src="/img/Rfig/rate-viz4-dec-08-2016,-1.svg" alt="plot of chunk rate-viz4-dec-08-2016," /></p>

<h1 id="step-function">5: Step function</h1>

<p>We can use a step function to compare the annual average to the weekly values. What we’ll do in this plot is compute the annual average (using data.table()) and plot it as a step function on top of the line chart from 1.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#compute monthly and annual averages:
</span><span class="n">pmms30yr</span><span class="p">[,</span><span class="n">rate.y</span><span class="o">:=</span><span class="n">mean</span><span class="p">(</span><span class="n">rate</span><span class="p">),</span><span class="n">by</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"year"</span><span class="p">)]</span>

<span class="n">g5</span><span class="o">&lt;-</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;</span><span class="s1">'2000-12-31'</span><span class="p">],</span>  
       <span class="c1">#We're going to subset the data to be after Dec 31, 2000.  
</span>       <span class="c1">#We could use filter function, but instead I'm using the data.table() shorthand
</span>        <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">rate</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_line</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>
  
  <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="c1">#set date breaks at 1 year, format as 2000 ("%Y"), 00 would be "%y"
</span>    <span class="n">scale_x_date</span><span class="p">(</span><span class="n">date_breaks</span><span class="o">=</span><span class="s2">"1 year"</span><span class="p">,</span> <span class="n">date_labels</span><span class="o">=</span><span class="s2">"%Y"</span><span class="p">)</span><span class="o">+</span>  
  <span class="c1">#add annual average as step function
</span>  <span class="n">geom_step</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">rate.y</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">viridis</span><span class="p">(</span><span class="m">5</span><span class="p">)[</span><span class="m">2</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">1.1</span><span class="p">)</span><span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate (%)"</span><span class="p">,</span>
       <span class="n">subtitle</span><span class="o">=</span><span class="s2">"Weekly rates since 2001, blue line annual average"</span><span class="p">,</span>
       <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="n">g5</span></code></pre></figure>

<p><img src="/img/Rfig/rate-viz5-dec-08-2016,-1.svg" alt="plot of chunk rate-viz5-dec-08-2016," /></p>

<h1 id="pie-chart">6: Pie Chart</h1>

<p>We can also make a Pie chart:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">g6</span><span class="o">&lt;-</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">==</span><span class="m">2015</span><span class="p">],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">as.character</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s2">"%b"</span><span class="p">)))</span><span class="o">+</span>
  <span class="n">geom_bar</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">"identity"</span><span class="p">)</span> <span class="o">+</span> <span class="n">coord_polar</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme_void</span><span class="p">()</span><span class="o">+</span>  <span class="n">scale_fill_viridis</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Month"</span><span class="p">,</span><span class="n">discrete</span><span class="o">=</span><span class="n">T</span><span class="p">)</span><span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Share of a year"</span><span class="p">)</span>
<span class="n">g6</span></code></pre></figure>

<p><img src="/img/Rfig/rate-viz6-dec-08-2016,-1.svg" alt="plot of chunk rate-viz6-dec-08-2016," /></p>

<p>Ha ha, just kidding, that’s awful!</p>

<h1 id="strip-chart">7: Strip chart</h1>

<p>I just tried this chart out today and I really like it.  It’s a strip chart that shows the year-over-year percent change in mortgage rates. You can’t read the information as accurately as a line chart, but it gives you a much better impression on how rates have been changing.  Let’s make it and then discuss more:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">g7</span><span class="o">&lt;-</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2000</span><span class="p">,],</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">week</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">d52</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">d52</span><span class="p">))</span><span class="o">+</span>
  <span class="n">geom_col</span><span class="p">()</span><span class="o">+</span>
  <span class="n">scale_fill_viridis</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"52-week\nChange (pp)"</span><span class="p">,</span><span class="n">discrete</span><span class="o">=</span><span class="n">F</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s2">"B"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">scale_color_viridis</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"52-week\nChange (pp)"</span><span class="p">,</span><span class="n">discrete</span><span class="o">=</span><span class="n">F</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s2">"B"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
  <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">year</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">axis.ticks.y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
        <span class="n">axis.text.y</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
        <span class="n">panel.grid.major</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
        <span class="n">panel.grid.minor</span><span class="o">=</span><span class="n">element_blank</span><span class="p">(),</span>
        <span class="n">axis.text.x</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="p">))</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate"</span><span class="p">,</span>
       <span class="n">subtitle</span><span class="o">=</span><span class="s2">"52-week change in percentage points"</span><span class="p">,</span>
       <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span><span class="o">+</span>
  <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">26</span><span class="p">,</span><span class="m">52</span><span class="p">),</span><span class="n">labels</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"Jan"</span><span class="p">,</span><span class="s2">"Jul"</span><span class="p">,</span><span class="s2">"Dec"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">8</span><span class="p">))</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">))</span>
<span class="n">g7</span></code></pre></figure>

<p><img src="/img/Rfig/rate-viz7-dec-08-2016,-1.svg" alt="plot of chunk rate-viz7-dec-08-2016," /></p>

<p>While you can’t read the values from this chart as clearly as a line chart (or a table), you can quickly get a <em>feel</em> for the important trends in the data.  The bright yellow periods are when mortgage rates were rising, while the dark purple corresponds to periods when rates were falling.  It’s pretty easy to see that 2001, 2003, 2009 and 2012 were years when rates fell a lot, while 2006, 2013, and 2014 were when rates were rising relative to the previous year.</p>

<h1 id="animated-line-chart">8: Animated Line Chart</h1>

<p>These next three charts are animated versions of some the preceding charts.  We’ll start with a simple animated line chart from 1.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">N</span><span class="o">&lt;-</span><span class="n">max</span><span class="p">(</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">==</span><span class="m">2016</span><span class="p">]</span><span class="o">$</span><span class="n">week</span><span class="p">)</span>  
<span class="n">oopt</span> <span class="o">=</span> <span class="n">ani.options</span><span class="p">(</span><span class="n">interval</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span>
<span class="n">saveGIF</span><span class="p">({</span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">g</span><span class="o">&lt;-</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;=</span><span class="s1">'2015-12-31'</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">rate</span><span class="p">))</span><span class="o">+</span><span class="n">geom_line</span><span class="p">()</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">scale_x_date</span><span class="p">(</span><span class="n">date_breaks</span><span class="o">=</span><span class="s2">"1 month"</span><span class="p">,</span> <span class="n">date_labels</span><span class="o">=</span><span class="s2">"%b"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4.2</span><span class="p">),</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4.2</span><span class="p">,</span><span class="m">.1</span><span class="p">))</span><span class="o">+</span>
    <span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;=</span><span class="s1">'2015-12-31'</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">==</span><span class="n">i</span><span class="p">],</span><span class="n">nudge_x</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;=</span><span class="s1">'2015-12-31'</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">==</span><span class="n">i</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Mortgage Rate (%)"</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate (%)"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"weekly rates in 2016"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">18</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2015-12-31"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-11-30"</span><span class="p">)),</span> <span class="n">y</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">3.3</span><span class="p">,</span><span class="m">4.2</span><span class="p">))</span>
  <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
  <span class="n">ani.pause</span><span class="p">()</span>
<span class="p">}</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="n">i2</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">ani.pause</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">},</span><span class="n">movie.name</span><span class="o">=</span><span class="s2">"rate_12_08_2016.gif"</span><span class="p">,</span><span class="n">ani.width</span> <span class="o">=</span> <span class="m">650</span><span class="p">,</span> <span class="n">ani.height</span> <span class="o">=</span> <span class="m">400</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/charts_dec_8_2016/rate_12_08_2016.gif" alt="pmms gif 2016" /></p>

<h1 id="animated-line-chart-2">9: Animated Line Chart 2</h1>

<p>We can also construct an animation for the weekly comparison line chart:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">oopt</span> <span class="o">=</span> <span class="n">ani.options</span><span class="p">(</span><span class="n">interval</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span>
<span class="n">saveGIF</span><span class="p">({</span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">g</span><span class="o">&lt;-</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2012</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">],</span> 
           <span class="n">aes</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">week</span><span class="o">/</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">week</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="n">year</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">as.factor</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">geom_line</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1.05</span><span class="p">)</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="n">scale_color_viridis</span><span class="p">(</span><span class="n">discrete</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="m">0.9</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">50</span><span class="p">),</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">5</span><span class="p">))</span><span class="o">+</span>
    <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">3.25</span><span class="p">,</span><span class="m">4.75</span><span class="p">),</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">3.25</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">0.25</span><span class="p">))</span><span class="o">+</span>
    <span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2012</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">==</span><span class="n">i</span><span class="p">],</span><span class="n">nudge_x</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2012</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">==</span><span class="n">i</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">3.5</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Week Number"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Mortgage Rate (%)"</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate by Week of Year"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"comparing 2013, 2014, 2015 and 2016"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">18</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span>
  <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
  <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="n">ani.pause</span><span class="p">()</span>
<span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i2</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="m">20</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">print</span><span class="p">(</span><span class="n">i2</span><span class="p">)</span>
    <span class="n">ani.pause</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">},</span><span class="n">movie.name</span><span class="o">=</span><span class="s2">"rate_compare_dec_08_2016.gif"</span><span class="p">,</span><span class="n">ani.width</span> <span class="o">=</span> <span class="m">500</span><span class="p">,</span> <span class="n">ani.height</span> <span class="o">=</span> <span class="m">350</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/charts_dec_8_2016/rate_compare_dec_08_2016.gif" alt="pmms gif weekly" /></p>

<h1 id="animated-line-chart-with-annotations">10: Animated line chart with annotations</h1>

<p>We can also add some annotations and some more detailed camerawork for the animated linechart.</p>

<p>The way we’ll do it, is set up a function that takes two input dates, a minimum and a maximum. The data will then get truncated at the min and max dates, allowing us to zoom around the time series history of mortgage rates.</p>

<p>For smoother animations we’ll use tweenr.See my earlier <a href="/2016/05/29/improving-R-animated-gifs-with-tweenr">post about tweenr</a> for an introduction to tweenr, and more examples <a href="/2016/05/30/more-tweenr-animations">here</a> and <a href="/2016/06/26/week-in-review">here</a>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">tweenr</span><span class="p">)</span>
<span class="n">DT</span><span class="o">&lt;-</span><span class="n">copy</span><span class="p">(</span><span class="n">pmms30yr</span><span class="p">)</span>
<span class="n">myf</span><span class="o">&lt;-</span><span class="k">function</span><span class="p">(</span><span class="n">dd</span><span class="p">,</span><span class="n">dmin</span><span class="o">=</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2014-12-31"</span><span class="p">),</span>
              <span class="c1">#Variable subt contains annotations in the subtitle frame
</span>              <span class="n">subt</span><span class="o">=</span><span class="s2">"Nothing"</span><span class="p">,</span>
              <span class="n">keepdots</span><span class="o">=</span><span class="s2">"No"</span><span class="p">){</span>
  <span class="n">DT2</span><span class="o">&lt;-</span><span class="n">copy</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span>
  <span class="c1">#set max to last value
</span>  <span class="n">DT2</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;</span><span class="n">dd</span><span class="p">,</span><span class="n">rate</span><span class="o">:=</span><span class="n">DT</span><span class="p">[</span><span class="n">date</span><span class="o">==</span><span class="n">dd</span><span class="p">]</span><span class="o">$</span><span class="n">rate</span><span class="p">]</span>
  <span class="n">DT2</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;</span><span class="n">dd</span><span class="p">,</span><span class="n">date</span><span class="o">:=</span><span class="n">dd</span><span class="p">]</span>
  <span class="c1">#set min to first value
</span>  <span class="n">DT2</span><span class="p">[</span><span class="n">date</span><span class="o">&lt;=</span><span class="n">dmin</span><span class="p">,</span><span class="n">rate</span><span class="o">:=</span><span class="n">DT</span><span class="p">[</span><span class="n">date</span><span class="o">==</span><span class="n">dmin</span><span class="p">]</span><span class="o">$</span><span class="n">rate</span><span class="p">]</span>
  <span class="n">DT2</span><span class="p">[</span><span class="n">date</span><span class="o">&lt;=</span><span class="n">dmin</span><span class="p">,</span><span class="n">date</span><span class="o">:=</span><span class="n">dmin</span><span class="p">]</span>
  <span class="n">DT2</span><span class="p">[,</span><span class="n">subt</span><span class="o">:=</span><span class="n">label_wrap_gen</span><span class="p">(</span><span class="m">100</span><span class="p">)(</span><span class="n">subt</span><span class="p">)]</span>
  <span class="n">DT2</span><span class="o">$</span><span class="n">subt</span><span class="o">&lt;-</span><span class="n">factor</span><span class="p">(</span><span class="n">DT2</span><span class="o">$</span><span class="n">subt</span><span class="p">)</span>
  <span class="n">DT2</span><span class="o">$</span><span class="n">keepdots</span><span class="o">&lt;-</span><span class="n">factor</span><span class="p">(</span><span class="n">keepdots</span><span class="p">)</span>
  <span class="n">as.data.frame</span><span class="p">(</span><span class="n">DT2</span><span class="p">[,</span> <span class="n">list</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="n">rate</span><span class="p">,</span><span class="n">subt</span><span class="p">,</span><span class="n">keepdots</span><span class="p">)])}</span>


<span class="n">tf</span> <span class="o">&lt;-</span> <span class="n">tween_states</span><span class="p">(</span>
  <span class="n">list</span><span class="p">(</span><span class="n">myf</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-11-03"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2015-12-31"</span><span class="p">),</span><span class="n">subt</span><span class="o">=</span><span class="s2">"rates fell throughout most of 2016 up to the U.S. general election..."</span><span class="p">),</span>
       <span class="n">myf</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-12-01"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2015-12-31"</span><span class="p">),</span><span class="n">subt</span><span class="o">=</span><span class="s2">"...rising rapidly after the election...."</span><span class="p">),</span>
       <span class="n">myf</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-12-08"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2014-10-02"</span><span class="p">),</span><span class="n">subt</span><span class="o">=</span><span class="s2">"...rates are up to the highest level since Oct 2014...."</span><span class="p">),</span>
       <span class="n">myf</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-12-08"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2012-12-27"</span><span class="p">),</span><span class="n">subt</span><span class="o">=</span><span class="s2">"...having declined after the Taper Talk in 2013...."</span><span class="p">),</span>
       <span class="n">myf</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-12-08"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"1971-04-02"</span><span class="p">),</span><span class="n">subt</span><span class="o">=</span><span class="s2">"...and after over 30 years of general decline."</span><span class="p">),</span>
       <span class="n">myf</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2015-12-31"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2015-12-31"</span><span class="p">),</span><span class="n">subt</span><span class="o">=</span><span class="s2">"...rates entered 2016 above 4%, but..."</span><span class="p">)</span>
         <span class="p">),</span><span class="n">tweenlength</span><span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">statelength</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">ease</span><span class="o">=</span><span class="n">rep</span><span class="p">(</span><span class="s1">'cubic-in-out'</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="n">nframes</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>
<span class="n">tf</span><span class="o">&lt;-</span><span class="n">data.table</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>

<span class="n">oopt</span> <span class="o">=</span> <span class="n">ani.options</span><span class="p">(</span><span class="n">interval</span> <span class="o">=</span> <span class="m">0.15</span><span class="p">)</span>
<span class="n">saveGIF</span><span class="p">({</span><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="m">44</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">g</span><span class="o">&lt;-</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">date</span><span class="o">==</span><span class="s1">'2015-12-31'</span> <span class="o">|</span> <span class="p">(</span><span class="n">date</span><span class="o">&gt;=</span><span class="s1">'2015-12-31'</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">)],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span><span class="n">rate</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">geom_line</span><span class="p">()</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;=</span><span class="s1">'2015-12-31'</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">==</span><span class="n">i</span><span class="p">],</span><span class="n">nudge_x</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="o">+</span>
    <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">pmms30yr</span><span class="p">[</span><span class="n">date</span><span class="o">&gt;=</span><span class="s1">'2015-12-31'</span> <span class="o">&amp;</span> <span class="n">week</span><span class="o">==</span><span class="n">i</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Mortgage Rate (%)"</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate (%)"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"Rates fell throughout most of 2016 up to the U.S. general election..."</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">18</span><span class="p">))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
    <span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2015-12-31"</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-12-31"</span><span class="p">)),</span> <span class="n">y</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">3.25</span><span class="p">,</span><span class="m">4.01</span><span class="p">))</span>
  <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
  <span class="n">ani.pause</span><span class="p">()</span>
  <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="p">}</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="m">1</span><span class="p">){</span>
    <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">ani.pause</span><span class="p">()</span>
    <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="p">}</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">:</span><span class="n">max</span><span class="p">(</span><span class="n">tf</span><span class="o">$</span><span class="n">.frame</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">g</span><span class="o">&lt;-</span>
      <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tf</span><span class="p">[</span><span class="n">.frame</span><span class="o">==</span><span class="n">i</span><span class="p">],</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">rate</span><span class="p">))</span><span class="o">+</span><span class="n">geom_line</span><span class="p">()</span><span class="o">+</span><span class="n">theme_minimal</span><span class="p">()</span><span class="o">+</span>
      <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s2">"none"</span><span class="p">)</span><span class="o">+</span>
      <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tf</span><span class="p">[</span><span class="n">date</span><span class="o">==</span><span class="n">max</span><span class="p">(</span><span class="n">tf</span><span class="p">[</span><span class="n">.frame</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">$</span><span class="n">date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">.frame</span><span class="o">==</span><span class="n">i</span><span class="p">,],</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="m">0.75</span><span class="p">)</span><span class="o">+</span>
      <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Mortgage Rate (%)"</span><span class="p">,</span>
           <span class="n">title</span><span class="o">=</span><span class="s2">"30-year Fixed Mortgage Rate (%)"</span><span class="p">,</span>
           <span class="n">subtitle</span><span class="o">=</span><span class="n">tf</span><span class="p">[</span><span class="n">.frame</span><span class="o">==</span><span class="n">i</span><span class="p">,]</span><span class="o">$</span><span class="n">subt</span><span class="p">,</span>
           <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac Primary Mortgage Market Survey"</span><span class="p">)</span><span class="o">+</span>
      <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">18</span><span class="p">))</span><span class="o">+</span>
      <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
      <span class="n">theme</span><span class="p">(</span><span class="n">plot.margin</span><span class="o">=</span><span class="n">unit</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">,</span><span class="m">0.25</span><span class="p">),</span><span class="s2">"cm"</span><span class="p">))</span><span class="o">+</span>
      <span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">min</span><span class="p">(</span><span class="n">tf</span><span class="p">[</span><span class="n">.frame</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">$</span><span class="n">date</span><span class="p">),</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2016-12-31"</span><span class="p">)),</span> <span class="n">y</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">3.25</span><span class="p">,</span><span class="n">max</span><span class="p">(</span><span class="n">tf</span><span class="p">[</span><span class="n">.frame</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">$</span><span class="n">rate</span><span class="p">)))</span>
    
    <span class="n">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">ani.pause</span><span class="p">()</span>
    <span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">},</span><span class="n">movie.name</span><span class="o">=</span><span class="s2">"rate_12_08_2016_annotate.gif"</span><span class="p">,</span><span class="n">ani.width</span> <span class="o">=</span> <span class="m">500</span><span class="p">,</span> <span class="n">ani.height</span> <span class="o">=</span> <span class="m">350</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/charts_dec_8_2016/rate_12_08_2016_annotate.gif" alt="pmms gif annotate 2016" /></p>

<h1 id="more">More?</h1>

<p>I’ve got several other visualizations I use from time to time. Check back in this space for more.</p>

    </div>

    

    
  
    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="/2016/12/04/recursion" title="Nested recursion: Loops within loops within data frames ">&laquo; Previous</a></li>
    
      <li><a href="/archive.html">Archive</a></li>
    
      <li class="next"><a href="/2016/12/10/global-house-price-trends" title="Global house price trends ">Next &raquo;</a></li>
    
    </ul>
    <hr>
    
  </div>
</div>



      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2017 Len Kiefer
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
       
    • <span vertical-align:bottom> <a href="https://twitter.com/lenkiefer" class="twitter-follow-button" data-show-count="false">•   Follow @lenkiefer</a>
  
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</span>
• <script src="//platform.linkedin.com/in.js" type="text/javascript"></script>
<script type="IN/MemberProfile" data-id="https://www.linkedin.com/pub/leonard-kiefer/31/753/511" data-format="click" data-related="false" data-text="Leonard Kiefer"></script>
  • lenkiefer@hotmail.com
           </p>
      </div>
    </div>
    





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>

    
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/assets/themes/lentheme/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>





