<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Visual meditations on house prices, Part 6: state recovery</title>
    
    <meta name="author" content="Len Kiefer">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link href="/assets/themes/lentheme/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    
    <link href="/assets/themes/lentheme/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    
    <link href="/assets/themes/lentheme/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    
    <link href="/assets/themes/lentheme/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    
    
    

    
    

    
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/"><span class="icon-home3" style="font-size:24px"> Len Kiefer</a></span>
        </div>

        
        <div class="collapse navbar-collapse" id="jb-navbar-collapse" style="font-size:24px">
          <ul class="nav navbar-nav" >
        <li><a href="/archive.html"><span class="icon-newspaper"> Posts</a></span></li>
            
         <li><a href="/resume.html"><span class="icon-profile"> Resume</span></a></li>
        <li><a href="/about.html"><span class="icon-user-tie"> About</span></a></li>
          </ul>
        </div>
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>Visual meditations on house prices, Part 6: state recovery </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>03 November 2016</span>
    </div>
    <div class="content">
      <h1 id="introduction">Introduction</h1>

<p>HOUSE PRICES HAVE NOW RECOVERED BACK TO THEIR PRE-RECESSION PEAK, at least according to some indices.  The <a href="http://www.freddiemac.com/finance/house_price_index.html">Freddie Mac House Price Index</a>, for example, surpassed its pre-2008 peak in the latest release for data through September 2016. In this post I’ll be exploring trends in house prices and exploring different ways of showing how far house prices have come, and in some cases, how far they still have to go.</p>

<p>Time for some new visual meditations on house prices.</p>

<p>For reference, the prior meditation are listed below, and I’ll keep an updated list of all of them <a href="/2016/05/08/visual-meditations-on-house-prices">here</a>.</p>

<ul>
  <li><a href="/2016/05/08/visual-meditations-on-house-prices-part1">Part 1: data wrangling </a></li>
  <li><a href="/2016/05/08/visual-meditations-on-house-prices-part2">Part 2: sparklines and dots (animated) </a></li>
  <li><a href="/2016/05/10/visual-meditations-on-house-prices-part3">Part 3: bubbles and bounce </a></li>
  <li><a href="/2016/05/14/visual-meditations-on-house-prices-part4">Part 4: graph gallery </a></li>
  <li><a href="/2016/08/13/visual-meditations-on-house-prices-part5">Part 5: distributions </a></li>
</ul>

<p>These visualizations will be made in R, and I’ll post code for some of the graphs at the bottom.</p>

<h2 id="the-data">The data</h2>

<p>As <a href="/2016/05/08/visual-meditations-on-house-prices-part1">before</a>, we’ll be using the Freddie Mac House Price Index for many of these visualizations.  We’re going to need a text file organized as described in that post. Just follow those examples to set up the data.  Or you can download the two text files below:</p>

<ol>
  <li><a href="/img/charts_nov_3_2016/fmhpi2016q3.txt"><em>state and national called fmhpi.txt</em></a></li>
  <li><a href="/img/charts_nov_3_2016/fmhpi2016q3metro.txt"><em>metro called fmhpi2.txt</em></a></li>
</ol>

<p><img src="/img/Rfig/fig-hpimed6-viz1-1.svg" alt="plot of chunk fig-hpimed6-viz1" /></p>

<p>This plot shows the seasonally-adjusted index for the United States. In September of 2016 the index was at 165.25, just above (0.1%) the pre-2008 peak of 165.06.</p>

<p>The story varies quite a bit across the country. While the national average is just abvoe the pre-2008 peak, some states are above and some are below.</p>

<h2 id="state-trends">State trends</h2>

<h3 id="maps">Maps</h3>

<p>First, let’s look at a map of annual house price appreciation by state, September 2015 to September 2016:</p>

<p><img src="/img/Rfig/fig-hpimed6-viz2-1.svg" alt="plot of chunk fig-hpimed6-viz2" /></p>

<p>We can contrast this with a map showing the percentage difference between the September 2016 index and that state’s pre-2008 peak.</p>

<p><img src="/img/Rfig/fig-hpimed6-viz3-1.svg" alt="plot of chunk fig-hpimed6-viz3" /></p>

<p>This map reveals that North Dakota, Colorado, and Texas have had the fastest house price appreciation relative to their pre-2008 peak (45%, 38%, and 35% respectively). On the other end, Nevada, Connecticut  and Arizona are the lowest relative to their pre-2008 peak at -24%, -20%, and -18% respectively.</p>

<p>It would be interesting to compare the rank of states in terms of year-over-year house price appreciation.</p>

<p><img src="/img/Rfig/fig-hpimed6-viz3b-1.svg" alt="plot of chunk fig-hpimed6-viz3b" /></p>

<p>We can also construct a panel plot comparing the last few years:</p>

<p><img src="/img/Rfig/fig-hpimed6-viz3c-1.svg" alt="plot of chunk fig-hpimed6-viz3c" /></p>

<p>Early in the housing recovery the central United States, pretty much a straight path from Texas up to North Dakota had the fastest house price growth (or least decline).  But as the recovery has progressed, growth has accelerated in the West and in Florida.</p>

<p>The animated gif below shows how the rankings have changed each September from 1980-2016:</p>

<p><img src="/img/charts_nov_3_2016/fmhpi map 2016q3 v4.gif" alt="hpa rank map gif" /></p>

<h2 id="dot-plot">Dot plot</h2>

<p>In an <a href="/2016/05/08/visual-meditations-on-house-prices-part2">earlier post</a> I described how to make the following dotplot:</p>

<p><img src="/img/Rfig/fig-hpimed6-viz4-1.svg" alt="plot of chunk fig-hpimed6-viz4" /></p>

<p>The plot shows the value of the house price index in September 2016 relative to the past 12 months.  The color corresponds to the pace of house price appreciation, and the tail represents the range of the index over the past 12 months.</p>

<p>Hawaii has the highest index value (meaning that house prices have grown most in HI relative to December 2000), but the fastest year-over-year growth has been in Washington state.  You can see that in the graph by the blueness of the dot and in the length of the tail.</p>

<p>This is a fun graph to animate:</p>

<p><img src="/img/charts_nov_3_2016/redbluedot 2016q3.gif" alt="red blue gif" /></p>

<h2 id="metro-trends">Metro trends</h2>

<p>We can also look at trends at the metro level, which will be the topic of a future post.</p>

<h1 id="code-for-these-plots">Code for these plots</h1>

<p>Here is the code I used, using the data files I linked to above, to create these graphics.  Note that I’m use R and the development version of ggplot2.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Load some packages
</span><span class="n">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">zoo</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">animation</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">rgeos</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">maptools</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">albersusa</span><span class="p">,</span> <span class="n">warn.conflicts</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span>

<span class="c1">#load data
</span><span class="n">statedata</span> <span class="o">&lt;-</span> <span class="n">fread</span><span class="p">(</span><span class="s2">"data/fmhpi2016q3.txt"</span><span class="p">)</span>
<span class="n">statedata</span><span class="o">$</span><span class="n">date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">statedata</span><span class="o">$</span><span class="n">date</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s2">"%m/%d/%Y"</span><span class="p">)</span>

<span class="c1">#Now uses some data table calculations to compute percent changes in house prices by state/metro
</span><span class="n">statedata</span><span class="o">&lt;-</span><span class="n">statedata</span><span class="p">[,</span><span class="n">hpa</span><span class="o">:=</span><span class="n">c</span><span class="p">(</span><span class="n">NA</span><span class="p">,((</span><span class="m">1</span><span class="o">+</span><span class="n">diff</span><span class="p">(</span><span class="n">hpi</span><span class="p">)</span><span class="o">/</span><span class="n">hpi</span><span class="p">))</span><span class="o">^</span><span class="m">12</span><span class="p">)</span><span class="m">-1</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">state</span><span class="p">]</span>  
<span class="n">statedata</span><span class="o">&lt;-</span><span class="n">statedata</span><span class="p">[,</span><span class="n">hpa12</span><span class="o">:=</span><span class="n">c</span><span class="p">(</span><span class="n">rep</span><span class="p">(</span><span class="n">NA</span><span class="p">,</span><span class="m">12</span><span class="p">),((</span><span class="m">1</span><span class="o">+</span><span class="n">diff</span><span class="p">(</span><span class="n">hpi</span><span class="p">,</span><span class="m">12</span><span class="p">)</span><span class="o">/</span><span class="n">hpi</span><span class="p">))</span><span class="o">^</span><span class="m">1</span><span class="p">)</span><span class="m">-1</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">state</span><span class="p">]</span>  

<span class="c1">#compute pre-2008 peak
</span><span class="n">statedata</span><span class="p">[,</span><span class="n">hpi.max08</span><span class="o">:=</span><span class="n">max</span><span class="p">(</span><span class="n">ifelse</span><span class="p">(</span><span class="n">year</span><span class="o">&lt;</span><span class="m">2009</span><span class="p">,</span><span class="n">hpi</span><span class="p">,</span><span class="m">0</span><span class="p">),</span><span class="n">na.rm</span><span class="o">=</span><span class="n">T</span><span class="p">),</span><span class="n">by</span><span class="o">=</span><span class="n">state</span><span class="p">]</span>

<span class="c1">#compute post-2008 trough
</span><span class="n">statedata</span><span class="p">[,</span><span class="n">hpi.min08</span><span class="o">:=</span><span class="n">min</span><span class="p">(</span><span class="n">ifelse</span><span class="p">(</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2008</span><span class="p">,</span><span class="n">hpi</span><span class="p">,</span><span class="m">1000</span><span class="p">),</span><span class="n">na.rm</span><span class="o">=</span><span class="n">T</span><span class="p">),</span><span class="n">by</span><span class="o">=</span><span class="n">state</span><span class="p">]</span>


<span class="c1">#do map stuff
</span><span class="n">states</span><span class="o">&lt;-</span><span class="n">usa_composite</span><span class="p">()</span>
<span class="n">statedata</span><span class="p">[,</span><span class="n">iso_3166_2</span><span class="o">:=</span><span class="n">state</span><span class="p">]</span>  <span class="c1">#rename state to match usa_composite
</span><span class="n">statedata</span><span class="p">[,</span><span class="n">hpi.comp</span><span class="o">:=</span><span class="n">hpi</span><span class="o">/</span><span class="n">hpi.max08</span><span class="m">-1</span><span class="p">]</span>  <span class="c1">#compute house price growth relative to pre-2008 peak
</span><span class="n">statedata</span><span class="o">&lt;-</span><span class="n">statedata</span><span class="p">[</span><span class="o">!</span><span class="p">(</span><span class="n">state</span> <span class="o">%</span><span class="k">in</span><span class="o">%</span> <span class="n">c</span><span class="p">(</span><span class="s2">"US.SA"</span><span class="p">,</span><span class="s2">"US.NSA"</span><span class="p">))]</span>
<span class="n">statedata</span><span class="p">[,</span><span class="n">hparank</span><span class="o">:=</span><span class="n">rank</span><span class="p">(</span><span class="o">-</span><span class="n">hpa12</span><span class="p">),</span><span class="n">by</span><span class="o">=</span><span class="n">date</span><span class="p">]</span>

<span class="c1">#create an indicator for house price appreciation relative to pre-2008 peak
</span><span class="n">statedata</span><span class="p">[,</span><span class="n">hpi.compd</span><span class="o">:=</span><span class="n">ifelse</span><span class="p">(</span><span class="n">hpi.comp</span><span class="o">&lt;</span> <span class="m">-0.25</span><span class="p">,</span><span class="s2">"&lt;-25%"</span><span class="p">,</span>
                             <span class="n">ifelse</span><span class="p">(</span><span class="n">hpi.comp</span><span class="o">&lt;</span> <span class="m">-0.05</span><span class="p">,</span><span class="s2">"-25% to -5%"</span><span class="p">,</span>
                                    <span class="n">ifelse</span><span class="p">(</span><span class="n">hpi.comp</span><span class="o">&lt;</span><span class="m">0</span><span class="p">,</span><span class="s2">"-5% to 0%"</span><span class="p">,</span>
                                           <span class="n">ifelse</span><span class="p">(</span><span class="n">hpi.comp</span><span class="o">&lt;</span><span class="m">0.05</span><span class="p">,</span><span class="s2">"0% to +5%"</span><span class="p">,</span>
                                                  <span class="n">ifelse</span><span class="p">(</span><span class="n">hpi.comp</span><span class="o">&lt;</span><span class="m">0.25</span><span class="p">,</span><span class="s2">"+5% to +25%"</span><span class="p">,</span>
                                                         <span class="s2">"&gt;+25%"</span><span class="p">)))))</span>     <span class="p">]</span>
<span class="n">statedata</span><span class="o">$</span><span class="n">hpi.compd</span><span class="o">&lt;-</span><span class="n">factor</span><span class="p">(</span><span class="n">statedata</span><span class="o">$</span><span class="n">hpi.compd</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">unique</span><span class="p">(</span><span class="n">statedata</span><span class="o">$</span><span class="n">hpi.compd</span><span class="p">))</span>
<span class="n">smap</span><span class="o">&lt;-</span><span class="n">fortify</span><span class="p">(</span><span class="n">states</span><span class="p">,</span><span class="n">region</span><span class="o">=</span><span class="s2">"fips_state"</span><span class="p">)</span>
<span class="n">states</span><span class="o">@</span><span class="n">data</span> <span class="o">&lt;-</span> <span class="n">left_join</span><span class="p">(</span><span class="n">states</span><span class="o">@</span><span class="n">data</span><span class="p">,</span> <span class="n">statedata</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="s2">"iso_3166_2"</span><span class="p">)</span>



<span class="c1">#make annual percent change map:
</span><span class="n">ggplot</span><span class="p">()</span> <span class="o">+</span>
  <span class="n">geom_map</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span> <span class="n">map</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span>
           <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">map_id</span> <span class="o">=</span> <span class="n">id</span><span class="p">),</span>
           <span class="n">color</span> <span class="o">=</span> <span class="s2">"#2b2b2b"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.05</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">NA</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">geom_map</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">states</span><span class="o">@</span><span class="n">data</span><span class="p">,</span><span class="n">year</span><span class="o">==</span><span class="m">2016</span> <span class="o">&amp;</span> <span class="n">month</span><span class="o">==</span><span class="m">9</span><span class="p">),</span> <span class="n">map</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span>
           <span class="n">aes</span><span class="p">(</span> <span class="n">map_id</span> <span class="o">=</span> <span class="n">fips_state</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">hpa12</span><span class="p">),</span>
           <span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">.25</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">theme_map</span><span class="p">(</span> <span class="n">base_size</span> <span class="o">=</span> <span class="m">12</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span> <span class="n">size</span> <span class="o">=</span> <span class="m">16</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span> <span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="m">-20</span><span class="p">)))</span> <span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">9</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">-15</span><span class="p">)))</span> <span class="o">+</span>
  <span class="n">coord_proj</span><span class="p">(</span><span class="n">us_laea_proj</span><span class="p">)</span> <span class="o">+</span>   <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">subtitle</span><span class="o">=</span><span class="s2">""</span> <span class="p">)</span> <span class="o">+</span>
  <span class="n">scale_fill_viridis</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">discrete</span><span class="o">=</span><span class="n">F</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="m">0.95</span><span class="p">,</span> 
                     <span class="n">direction</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0.12</span><span class="p">),</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">percent</span>
                     <span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s2">"top"</span><span class="p">)</span> <span class="o">+</span><span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Annual House Price Growth (Y/Y %)"</span><span class="p">,</span>

       <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac House Price Index (Not Seasonally adjusted)"</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/Rfig/unnamed-chunk-2-1.svg" alt="plot of chunk unnamed-chunk-2" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#make comparison to pre-2008 peak map
</span>
<span class="n">ggplot</span><span class="p">()</span> <span class="o">+</span>
  <span class="n">geom_map</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span> <span class="n">map</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span>
           <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">map_id</span> <span class="o">=</span> <span class="n">id</span><span class="p">),</span>
           <span class="n">color</span> <span class="o">=</span> <span class="s2">"#2b2b2b"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.05</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">NA</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">geom_map</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">states</span><span class="o">@</span><span class="n">data</span><span class="p">,</span><span class="n">year</span><span class="o">==</span><span class="m">2016</span> <span class="o">&amp;</span> <span class="n">month</span><span class="o">==</span><span class="m">9</span><span class="p">),</span> <span class="n">map</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span>
           <span class="n">aes</span><span class="p">(</span> <span class="n">map_id</span> <span class="o">=</span> <span class="n">fips_state</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">hpi.compd</span><span class="p">),</span>
           <span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">.25</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">theme_map</span><span class="p">(</span> <span class="n">base_size</span> <span class="o">=</span> <span class="m">12</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span> <span class="n">size</span> <span class="o">=</span> <span class="m">16</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span> <span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="m">-20</span><span class="p">)))</span> <span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">9</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">-15</span><span class="p">)))</span> <span class="o">+</span>
  <span class="n">coord_proj</span><span class="p">(</span><span class="n">us_laea_proj</span><span class="p">)</span> <span class="o">+</span>   <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">subtitle</span><span class="o">=</span><span class="s2">""</span> <span class="p">)</span> <span class="o">+</span>
  <span class="n">scale_fill_viridis</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">discrete</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="m">0.95</span> <span class="p">)</span><span class="o">+</span>
  <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s2">"top"</span><span class="p">)</span> <span class="o">+</span><span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"House Prices in September 2016 relative to pre-2008 peak"</span><span class="p">,</span>
             <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac House Price Index (Not Seasonally adjusted)"</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/Rfig/unnamed-chunk-2-2.svg" alt="plot of chunk unnamed-chunk-2" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># State annual house price appreciation rank map
</span>
<span class="n">ggplot</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">geom_map</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span> <span class="n">map</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span>
             <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">map_id</span> <span class="o">=</span> <span class="n">id</span><span class="p">),</span>
             <span class="n">color</span> <span class="o">=</span> <span class="s2">"#2b2b2b"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.05</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">NA</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">geom_map</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">states</span><span class="o">@</span><span class="n">data</span><span class="p">,</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2015</span> <span class="o">&amp;</span> <span class="n">month</span><span class="o">==</span><span class="n">mm</span><span class="p">),</span> <span class="n">map</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span>
             <span class="n">aes</span><span class="p">(</span> <span class="n">map_id</span> <span class="o">=</span> <span class="n">fips_state</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">hparank</span><span class="p">),</span>
             <span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">.25</span><span class="p">)</span> <span class="o">+</span>
  
    <span class="n">theme_map</span><span class="p">(</span> <span class="n">base_size</span> <span class="o">=</span> <span class="m">12</span><span class="p">)</span> <span class="o">+</span> 
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span> <span class="n">size</span> <span class="o">=</span> <span class="m">16</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span> <span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="m">-20</span><span class="p">)))</span> <span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">9</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">-15</span><span class="p">)))</span> <span class="o">+</span>
    <span class="n">coord_proj</span><span class="p">(</span><span class="n">us_laea_proj</span><span class="p">)</span> <span class="o">+</span>   <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">subtitle</span><span class="o">=</span><span class="s2">""</span> <span class="p">)</span> <span class="o">+</span>
    <span class="n">scale_fill_viridis</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">discrete</span><span class="o">=</span><span class="n">F</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="m">0.95</span><span class="p">,</span> 
                       <span class="n">direction</span><span class="o">=</span><span class="m">-1</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s2">"top"</span><span class="p">)</span> <span class="o">+</span><span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Rank for state + D.C. annual house price growth (1 to 51)"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"September of 2016"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac House Price Index (Not Seasonally adjusted)"</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/Rfig/unnamed-chunk-2-3.svg" alt="plot of chunk unnamed-chunk-2" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># State annual house price appreciation rank map, panel 2008-2016
</span>
<span class="n">ggplot</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">geom_map</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span> <span class="n">map</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span>
             <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">long</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lat</span><span class="p">,</span> <span class="n">map_id</span> <span class="o">=</span> <span class="n">id</span><span class="p">),</span>
             <span class="n">color</span> <span class="o">=</span> <span class="s2">"#2b2b2b"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">0.05</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">NA</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">geom_map</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">states</span><span class="o">@</span><span class="n">data</span><span class="p">,</span><span class="n">year</span><span class="o">&gt;</span><span class="m">2007</span> <span class="o">&amp;</span> <span class="n">month</span><span class="o">==</span><span class="n">mm</span><span class="p">),</span> <span class="n">map</span> <span class="o">=</span> <span class="n">smap</span><span class="p">,</span>
             <span class="n">aes</span><span class="p">(</span> <span class="n">map_id</span> <span class="o">=</span> <span class="n">fips_state</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">hparank</span><span class="p">),</span>
             <span class="n">color</span> <span class="o">=</span> <span class="s2">"gray"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">.25</span><span class="p">)</span> <span class="o">+</span>
  
    <span class="n">theme_map</span><span class="p">(</span> <span class="n">base_size</span> <span class="o">=</span> <span class="m">12</span><span class="p">)</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">year</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span> <span class="n">size</span> <span class="o">=</span> <span class="m">16</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span> <span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.subtitle</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">14</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="m">-20</span><span class="p">)))</span> <span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">9</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">-15</span><span class="p">)))</span> <span class="o">+</span>
    <span class="n">coord_proj</span><span class="p">(</span><span class="n">us_laea_proj</span><span class="p">)</span> <span class="o">+</span>   <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="n">subtitle</span><span class="o">=</span><span class="s2">""</span> <span class="p">)</span> <span class="o">+</span>
    <span class="n">scale_fill_viridis</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span> <span class="n">discrete</span><span class="o">=</span><span class="n">F</span><span class="p">,</span><span class="n">option</span><span class="o">=</span><span class="s2">"D"</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="m">0.95</span><span class="p">,</span> 
                       <span class="n">direction</span><span class="o">=</span><span class="m">-1</span> <span class="p">)</span><span class="o">+</span>
    <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s2">"top"</span><span class="p">)</span> <span class="o">+</span><span class="n">theme</span><span class="p">(</span><span class="n">plot.caption</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">vjust</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="m">10</span><span class="p">)))</span><span class="o">+</span>
    <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Rank for state + D.C. annual house price growth (1 to 51)"</span><span class="p">,</span>
         <span class="n">subtitle</span><span class="o">=</span><span class="s2">"September of year"</span><span class="p">,</span>
         <span class="n">caption</span><span class="o">=</span><span class="s2">"@lenkiefer Source: Freddie Mac House Price Index (Not Seasonally adjusted)"</span><span class="p">)</span></code></pre></figure>

<p><img src="/img/Rfig/unnamed-chunk-2-4.svg" alt="plot of chunk unnamed-chunk-2" /></p>


    </div>

    

    
  
    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="/2016/10/20/homeownership-history" title="Visualizing the history of U.S. homeownership rates">&laquo; Previous</a></li>
    
      <li><a href="/archive.html">Archive</a></li>
    
      <li class="next"><a href="/2016/11/21/consumer-price-viz" title="Visualizing recent trends in consumer prices">Next &raquo;</a></li>
    
    </ul>
    <hr>
    
  </div>
</div>



      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2017 Len Kiefer
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
       
    • <span vertical-align:bottom> <a href="https://twitter.com/lenkiefer" class="twitter-follow-button" data-show-count="false">•   Follow @lenkiefer</a>
  
 <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</span>
• <script src="//platform.linkedin.com/in.js" type="text/javascript"></script>
<script type="IN/MemberProfile" data-id="https://www.linkedin.com/pub/leonard-kiefer/31/753/511" data-format="click" data-related="false" data-text="Leonard Kiefer"></script>
  • lenkiefer@hotmail.com
           </p>
      </div>
    </div>
    





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66905937-1', 'auto');
  ga('send', 'pageview');

</script>

    
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/assets/themes/lentheme/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>





